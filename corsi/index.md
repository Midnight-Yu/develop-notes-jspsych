# CORSI 实验初步 demo 开发

## 2024-01-19

### 已完成部分
* staircase 任务全部做好了。
* 给数据文件简单地加了一个时间。

### 下一步要做的
* 自适应模式的制作。
* 插件的修改（主要是图片）。
* 对接需求修改刺激大小等属性。

### 其他
整了一下 .gitignore，这样不怕串文件了（

## 2024-01-18

### 已完成部分
* 写了三种 layout 下的不同布局和索引。
* 查了一圈，最新版 jsPsych 对 [conditional timeline 和 loop timeline](https://www.jspsych.org/7.0/overview/timeline/#looping-timelines) 有一些更新，所以顺手把依赖库全部换到了最新版。明天起来研究一下。
* 跟着上边初步阅读的结果构思了一下程序整体架构。
  * 大致是一个 timeline 里面包含三个子 timeline，触发条件由 difficulty 变量控制。
  * difficulty 变量可以直接用刺激方块的个数，毕竟这个是递增/序列化的，不存在重复和复用的情况，

### 问题
~~数据不对，手动输入的数据能够比较好地保存在数据文件里，但是函数生成的数据重复了。考虑到这是个反向的任务，这样对数据记录有很大的阻碍。~~

~~构造了该插件的分支版本，准备读插件是怎么处理数据的。这个问题咱是不是很重要，最保底的思路就是掏出 jsPsych 里的 data 方法嘛。~~

代码调着调着 它自己 好了。灵异事件了这下。我也没改插件啊。

咳。推测的话估计还是对 Javascript 拷贝机制的不熟悉（真不会写 JS），修改变量拷贝方法之后好了，估计是在某一次调整之后就已经修好了，但是忘了保存和 commit 导致我运行的还是旧版。

远期还是要考虑如何把方块刺激改成图片刺激，也就是说拆原始插件是必要的一环。有点麻烦。

### 后续设想构思
* 使用一个 difficulty 变量来控制整个程序的步进。可以先从 staircase 模式做起，先暂时不考虑自适应。
* 考虑如何编写自定义函数与回调，以及如何根据不同的参数触发不同的 trial。需要研究一下 timeline。

### 其他
* 整体挪了一下本地的 reposity，方便进一步随时更新版本 commit，免得再出改好了但是还在跑旧版的问题。都用 GitHub 了还不把版本控制搞起来那我用它干嘛（
* 对着屏幕发了一个小时的呆，主要是想整个实验的流程想得比较头痛。光想不行，还是得多写。
* JS 编程基础完全不过关，属于抓到什么写什么，遇到问题再去摇人。写现在的部分倒是够用了，就怕写着写着把什么东西搞坏了。

## 2024-01-17

### 已完成部分
完成了一个初步 trial 的构建（见[此 repo](https://github.com/Midnight-Yu/jspsych-adaptive-corsi-demo)）。
* jsPsych的默认框架为“1 trial, 1 response”。这种情况下要么硬堆trial数量（吃撑了），要么就得自行开发插件（comment by [Shaobin-Jiang](https://github.com/Shaobin-Jiang)）。
* 确实是不会手写 Javascript，好在找到了一个现成的CORSI任务插件——[corsi-blocks](https://github.com/jspsych/jspsych-contrib/tree/main/packages/plugin-corsi-blocks)。是一款社区插件。
* 用这个插件现场写了一个 trial 出来，看着能跑，单个 trial 目前很成功。
* 对页面 CSS 做了一些调整和规划，复用了之前实验使用的 CSS 框架。
* 还真让我把 randomization 做出来了，虽然比较粗糙，reverse 的问题也解决了。
  * 但是如何批量生成是个问题，现在是 trial by trial 的，考虑到这是个 trial 数量都不固定的任务，完全动态的生成是很有必要的。
* 做了下 timeline 和传参，目前的结果看上去一切都好，作为一个 demo 它很成功。

### 下一步做什么？
* ~~刺激和反应的 randomization。先搞定随机化再说自适应的问题。~~
  * ~~有个问题是，它的结构是把 display 和 input 分成两个 trial。考虑到任务的需求是反向，我就要分两次传参数。问题更大的是，好像 jsPsych 是一次性初始化所有 trial？不确定这里能不能写成动态的。~~
* ~~完全自动化的随机列表生成，为下一步出自适应做铺垫。~~
* 构建自适应框架，感觉会需要写很多个 timeline。
  * 需要分阶段分大小设置不同的网格
* 自行构建一个对应的插件
  * 这个地方只支持方块。考虑到图形化的需求，那必然是要重写这个插件的一部分逻辑的。还是得手写 JS，哈哈。
